<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>íšŒì›ê°€ì… | ì‹±ê¸€ë²™ê¸€ ì¹´í˜</title>
  <link rel="stylesheet" href="/css/signup_style.css">
</head>
<body>
<h1>íšŒì›ê°€ì… í˜ì´ì§€</h1>

<form action="" method="POST">
  <div>
    <label for="username">ì•„ì´ë””: </label>
    <input id="username" type="text" name="username" required>
  </div>
  <div>
    <label for="password">ë¹„ë°€ë²ˆí˜¸: </label>
    <input id="password" type="password" name="password" required>
  </div>
  <div>
    <label for="email">ì´ë©”ì¼: </label>
    <input id="email" type="email" name="email" required>
  </div>

  <div>
    <button id="register-btn">ê°€ì…</button>
  </div>
</form>

<div class="login-link">
  ì´ë¯¸ íšŒì›ì´ì‹ ê°€ìš”?
  <a href="/login">ë¡œê·¸ì¸</a>
</div>

<script>
  document.getElementById('register-btn').addEventListener('click', function(event) {
    event.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    const email = document.getElementById('email').value.trim();
    console.log("data");
    console.log(username, password, email);

    // ğŸ‘‡ ì…ë ¥ê°’ ê²€ì¦ ì¶”ê°€
    if (!username || !password || !email) {
      alert("ëª¨ë“  í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return; // ìš”ì²­ ë³´ë‚´ì§€ ì•Šê³  ì—¬ê¸°ì„œ ëëƒ„
    }

    if (!email.includes('@')) {
      alert(`ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.`);
      return;
    }

    const data = {
      "username": username,
      "password": password,
      "email": email,

    };

    fetch('/signup', {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify(data)
    })
        .then(response => {
          if (!response.ok) {
            return response.json().then(err => { throw err; });
          }
          return response.json();
        })
        .then(data => {
          alert(`íšŒì›ê°€ì… ì™„ë£Œ!`);
          window.location.href = '/signin'; //ì„±ê³µí•˜ë©´ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ
        })
        .catch(err => {
          let message = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
          // alert(err);
          if (err && err.error && err.error.message) {
            message = err.error.message;
          }
          alert(message);
          window.location.href = '/signup';
        });
  });
</script>

</body>
</html>